# RoomTex

This is the official implementation of RoomTex: Texturing Compositional Indoor Scenes via Iterative Inpainting.
### [Project Page](https://qwang666.github.io/RoomTex/) | [Paper](https://arxiv.org/abs/)
<div align=center>
<img src="teaser.png" width="100%"/>
</div>

## Stable Diffusion and ControlNet

Deploy stable-diffusion-webui as https://github.com/AUTOMATIC1111/stable-diffusion-webui

Download SDXL model from 

base model: https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0

refiner model: https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0

VAE model: https://huggingface.co/stabilityai/sdxl-vae

Download SDXL-controlnet depth model from https://huggingface.co/diffusers/controlnet-depth-sdxl-1.0


Modify the SDXL webui as sdxl/modify_code/readme.txt

then, run stable-diiffusion-webui on nowebui mode as

CUDA_VISIBLE_DEVICES=0 bash webui.sh --nowebui --port 7860

you can choose the GPU device by setting CUDA_VISIBLE_DEVICES and the port by setting --port

Then you can use the stable diffusion through this port

## Generate objects mesh from shapeE

Objects mesh can be generated by using https://github.com/openai/shap-e/blob/main/shap_e/examples/sample_text_to_3d.ipynb and change the prompt respectively.  


## Generate room mesh from sketch

python utils/mesh/gene_room.py --cfg demo/configs/livingroom.yaml

*use generated room, modify the config file to add room mesh path on room_mesh_path and boundary_mesh_path*

## Prepare the panorama and objects inpainting view depth of the scene

python scripts/prepare_depth.py --cfg demo/configs/livingroom.yaml

## Generate the panorama of the scene (port is the sd webui port)

python gene_img/pano/pano_text2img.py --cfg demo/configs/livingroom.yaml --port 7860

_choose one and modify the config file to add the panorama path on pano_all_2K_

## Refine the room panorama, modify the config file to add the empty room panorama path on pano_wall_2K

python gene_img/pano/refine_pano.py --cfg demo/configs/livingroom.yaml --port 7860

## Reproject the panorama to initial perspective image

python scripts/prepare_pers.py

## Genetate objects

_port is the sd webui port, id is the object id_

python scripts/iterative_gene.py --cfg demo/configs/livingroom.yaml --port 7860 --id 0

python scripts/adornment_refine.py --cfg demo/configs/livingroom.yaml --port 7860 --id 0

## Render figures of the scene, need to set poses

python scripts/render/render.py